<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Video Thumbnails with Basic Player</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .thumbnail {
            width: 100%;
            height: auto;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .video-container {
            max-width: 800px;
            margin: 0 auto;
            margin-bottom: 40px;
        }

        .thumbnail-gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .thumbnail-item {
            flex: 0 0 30%;
            cursor: pointer;
            text-align: center;
        }

        canvas {
            display: none;
        }
    </style>
</head>
<body>

<div class="container my-5">
    <h1 class="text-center mb-5">Dynamic Video Thumbnails with Basic Player</h1>

    <!-- Basic Video Player // You can use any if you need -->
    <div class="video-container">
        <video id="videoPlayer" controls preload="auto" width="100%" height="400">
            <source id="videoSource" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
    <div class="row" id="thumbnailGallery">
    </div>
    <canvas id="canvas" style="display:none;"></canvas>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Fetch video URLs from PHP and dynamically generate thumbnails
    function loadVideos() {
        fetch('o.php') // Fetch video url from php if you have array data mention it in o.php or if you have folder and want to load it dynamically or automically use v.php
            .then(response => response.json()) // Parse JSON response
            .then(videos => {
                const thumbnailGallery = document.getElementById('thumbnailGallery');
                thumbnailGallery.innerHTML = ''; // Clear any existing thumbnails

                videos.forEach((videoUrl, index) => {
                    const col = document.createElement('div');
                    col.className = 'col-lg-4 col-md-6 thumbnail-item';

                    //for the thumbnail
                    const thumbnailImage = document.createElement('img');
                    thumbnailImage.className = 'thumbnail img-fluid';
                    thumbnailImage.alt = `Video ${index + 1}`;
                    thumbnailImage.dataset.videoUrl = videoUrl;
                    thumbnailImage.onclick = () => loadVideo(videoUrl); 
                    generateThumbnail(videoUrl, thumbnailImage).catch(err => {
                        console.error(`Error generating thumbnail for ${videoUrl}`, err);
                    });

                    // Append to the gallery
                    col.appendChild(thumbnailImage);
                    thumbnailGallery.appendChild(col);
                });
            })
            .catch(error => console.error('Error fetching videos:', error));
    }

    // Function to generate video thumbnails using a new video element and canvas
    function generateThumbnail(videoUrl, imgElement) {
        return new Promise((resolve, reject) => {
            const tempVideo = document.createElement('video'); // Create a new hidden video element
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            tempVideo.style.display = 'none'; 
            tempVideo.src = videoUrl; 
            document.body.appendChild(tempVideo); 
            tempVideo.onloadedmetadata = function () {
               tempVideo.currentTime = 5; // Seek to 2 seconds to capture the thumbnail, you may change if you need
            };
            tempVideo.onseeked = function () {
                canvas.width = tempVideo.videoWidth;
                canvas.height = tempVideo.videoHeight;
                context.drawImage(tempVideo, 0, 0, canvas.width, canvas.height);
                imgElement.src = canvas.toDataURL('image/png');
                                document.body.removeChild(tempVideo);
                resolve();
            };

            tempVideo.onerror = function (e) {
                console.error(`Error loading video ${videoUrl}: `, e);
                reject(e); // Reject the promise if there's an error
            };
        });
    }
    function loadVideo(videoUrl) {
        const videoSource = document.getElementById('videoSource');
        videoSource.src = videoUrl;
        const videoPlayer = document.getElementById('videoPlayer');
        videoPlayer.load(); // Load the new video
        videoPlayer.play(); // Play the video
    }

    window.onload = loadVideos;
</script>

</body>
</html>
